doctype html
html
  head
    meta(charset="utf-8")
    title 文件管理
    link(rel="stylesheet", href="/static/js/layui/css/layui.css")
    link(rel="stylesheet", href="/static/css/common.css")
    style.
      .circle {
        width: 100px;
        height: 100px;
        background-color: #666;
        border-radius: 50%;
        position: relative;
      }
      .circle:before {
        display: block;
        content: '';
        width: 50px;
        height: 50px;
        background-color: #fff;
        opacity: 0.2;
        border-radius: 50%;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        position: absolute;
        margin: auto;
        animation: circle 1s infinite;
      }
      @keyframes circle {
        0% {
          width: 0;
          height: 0;
        }
        100% {
          width: 100%;
          height: 100%;
        }
      }
  body
    table.layui-table(lay-size="sm")
      caption
        .layui-btn-container.text-right
          a.layui-btn.layui-btn-normal.layui-btn-sm(href="javascript:deleteThis()") 删除全部
      thead
        tr
          th 序号
          th 文件名
          th 文件大小
          th 文件类型
          th 上传时间
          th 操作
      tbody
        each file, index in files
          tr
            td=index+1
            td=file.name
            td=(file.size/1024).toFixed(2)+'\tKB'
            td=file.type
            td=fn.moment(file.datetime)
            td
              a(href="javascript:deleteThis('"+file.id+"')") 删除
        if !files.length
          tr
            td.text-center(colspan="6") 暂无文件
    script(src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js")
    script(src="/static/js/layui/layui.js")
    script(src="/static/js/common.js")
    script.
      const deleteThis = (id) => {
        const deleteUrl = '/files/delete',
              fileId = id ? { id: id } : null
        if (!fileId) {
          layer.confirm('确定删除全部文件 ?', {
            yes: index => {
              sendAjax(deleteUrl, null, () => {
                refresh(window)
              })
            }
          })
        } else {
          sendAjax(deleteUrl, fileId, () => {
            refresh(window)
          })
        }
      }
      const sendAjax = (url, data, successCallback) => {
        $.post(url, data, (data, textStatus, jqXHR) => {
          successCallback && successCallback(data, textStatus, jqXHR)
        })
      }